| No.  | 変数タイプ                                                   | 優先順位（低→高） | 変数の概要説明                                               | 変数定義のパス                                               | 変数の使用方法の例                                           | 数百人が並行開発するプロジェクトでの使用推奨  (変数の競合や意図しない上書きを極力避ける) | 推奨/非推奨の理由                                            |
| ---- | ------------------------------------------------------------ | ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1    | コマンドライン値（例：-u  my_user、これらは変数ではありません） | 1                 | Ansibleまたはansible-playbookコマンド実行時に指定するコマンドラインオプション。例えば、-uはリモートユーザーを指定します。これらは変数ではありませんが、Playbookの実行に影響を与えます。 | 特定のパスはなし（Ansibleコマンド実行時に直接指定）          | shell     ansible-playbook playbook.yml -u my_user           | 非推奨                                                       | 1. 一貫性の欠如：コマンドラインオプションの使用は、ユーザーや環境によって実行結果が異なる可能性があります。 2. 追跡困難：コマンドラインオプションはPlaybookや設定に記録されないため、再現や監査が困難です。 3. 拡張性の低さ：全員が同じコマンドラインオプションを使用することに依存し、エラーが発生しやすいです。 |
| 2    | role  defaults（Roleディレクトリ構造で定義）                 | 2                 | Roleの標準ディレクトリ構造内で、defaults/main.ymlに定義される変数。defaults変数は、ユーザーがすべての変数を提供せずにRoleを使用できるように、合理的なデフォルト設定を提供します。 | roles/role_name/defaults/main.yml                            | yaml     # roles/role_name/defaults/main.yml     var_test02: "This is role defaults" | 非推奨                                                       | 1.  変数名の競合：ユーザーがPlaybookや他の変数レベルで同じ変数名を定義すると、意図しない上書きや競合が発生する可能性があります。 2. ドキュメントの必要性：どの変数を上書きでき、デフォルト値が何であるかをユーザーに明確に伝えるために、詳細なドキュメントが必要です。 3. デフォルト変数の過多：過度のデフォルト変数は設定の複雑さを増し、ユーザーが理解し管理するのが難しくなります。 4. 変数優先順位への依存：ユーザーはAnsibleの変数優先順位の仕組みを理解する必要があり、意図しない上書きを避けるためです。 5. メンテナンスコスト：より多くの設定オプションをサポートする際、defaultsファイルの頻繁な更新が必要となり、メンテナンスコストが増加します。 |
| 3    | Inventory  FileまたはスクリプトのGroup     変数              | 3                 | Inventory  Fileまたは動的Inventory Scriptで特定のGroup     に定義された変数。該当Group     内のすべてのHostに適用されます。 | inventory/inventory.yml                                      | yaml     # inventory/inventory.yml     all:      children:      webservers:      hosts:      web1.example.com:      web2.example.com:      vars:      http_port: 80 | 非推奨                                                       | 1.  変数の競合：Inventoryで変数を定義すると、複数のGroupで同じ変数名が定義され、競合が発生する可能性があります。 2.  管理の難しさ：Groupや変数の数が増えると、管理が複雑になります。 3. バージョン管理の欠如：Inventory File     がバージョン管理されていない、または頻繁に変更されると、一貫性が失われます。 |
| 4    | inventory  group_vars/all                                    | 4                 | Inventoryディレクトリ内のgroup_vars/allファイルに定義された変数。Inventory内のすべてのHostに適用されます。 | inventory/group_vars/all.yml                                 | yaml     # inventory/group_vars/all.yml     common_var: "value" | 慎重に使用                                                   | 1.  変数競合の可能性：group_vars/all内の変数は適用範囲が広く、意図せず他の場所で定義された変数を上書きする可能性があります。 2. 追跡の難しさ：group_vars/allの変更は広範囲に影響を与え、デバッグが困難です。 3. 調整の必要性：開発者間で変数定義を調整し、競合を避ける必要があります。 |
| 5    | playbook  group_vars/all                                     | 5                 | Playbookディレクトリ内のgroup_vars/allファイルに定義された変数。該当Playbookを実行する際、すべてのHostに適用されます。 | playbook_dir/group_vars/all.yml                              | yaml     # playbook_dir/group_vars/all.yml     common_var: "value" | 慎重に使用                                                   | 1.  変数競合の可能性：playbook group_vars/all内の変数はinventory group_vars/allを上書きします。 2. 調整の必要性：開発者間で変数定義を調整し、競合を避ける必要があります。 |
| 6    | inventory  group_vars/*                                      | 6                 | Inventoryディレクトリのgroup_varsディレクトリ内で特定のGroup     に定義された変数。該当Group     のすべてのHostに適用されます。 | inventory/group_vars/webservers.yml                          | yaml     # inventory/group_vars/webservers.yml     nginx_port: 80 | 推奨                                                         | 推奨理由： 1. 良好な組織化：Groupごとに変数を整理し、特定Groupの設定管理に役立ちます。 2. バージョン管理：変数がファイルに保存され、バージョン管理と協調作業が容易です。 3. メンテナンス性：大規模なチームに適用可能で、管理と保守が容易です。 |
| 7    | playbook  group_vars/*                                       | 7                 | Playbookディレクトリのgroup_varsディレクトリ内で特定のGroup     に定義された変数。該当Playbook実行時、そのGroup     のすべてのHostに適用されます。 | playbook_dir/group_vars/dbservers.yml                        | yaml     # playbook_dir/group_vars/dbservers.yml     mysql_port: 3306 | 推奨                                                         | 推奨理由： 1. 分離性：特定のPlaybookに変数を定義し、変数の分離性を高めます。 2. バージョン管理：変数ファイルをバージョン管理に含め、協調作業が容易です。 3. 可読性：Playbookの可読性と保守性を向上させます。 |
| 8    | Inventory  File     またはスクリプトのHost変数               | 8                 | Inventory  File     または動的Inventory Script     で特定のHostに定義された変数。該当Hostにのみ適用されます。 | inventory/inventory.yml                                      | yaml     # inventory/inventory.yml     all:      hosts:      web1.example.com:      http_port: 8080 | 非推奨                                                       | 1.  拡張性の問題：Inventory FileでHost変数を管理することは、大量のHostには適していません。 2.  変数の競合：他の場所でHost変数が定義されている場合、競合が発生する可能性があります。 3.  メンテナンス負担：Inventory内のHost固有の変数の管理が困難です。 |
| 9    | inventory  host_vars/*                                       | 9                 | Inventoryディレクトリのhost_varsディレクトリ内で特定のHostに定義された変数。該当Hostにのみ適用されます。 | inventory/host_vars/web1.example.com.yml                     | yaml     # inventory/host_vars/web1.example.com.yml     http_port: 8080 | 非推奨                                                       | 1.  拡張性の問題：大量のHostに対して個別のHost変数ファイルを管理することは現実的ではありません。 2.  保守コスト：各Hostごとに変数ファイルを維持する必要があります。 3. Host固有設定の奨励：インフラストラクチャをコードとして扱う原則に反します。 |
| 10   | playbook  host_vars/*                                        | 10                | Playbookディレクトリのhost_varsディレクトリ内で特定のHostに定義された変数。 | playbook_dir/host_vars/db1.example.com.yml                   | yaml     # playbook_dir/host_vars/db1.example.com.yml     db_port: 5432 | 非推奨                                                       | 上記と同様：  1. 拡張性の問題。 2. 保守コスト。 3. Host固有設定の奨励。 |
| 11   | Hostファクト  / キャッシュされた set_facts                   | 11                | setupモジュールで収集されたHostファクト（ansible_facts）や、set_factで定義されキャッシュされた変数。 | 自動的に収集されるか、set_factで定義・キャッシュ             | yaml     # 収集されたファクトの使用例     - name: Display hostname      debug:      msg: "The hostname is {{  ansible_facts['hostname'] }}" | 推奨                                                         | 推奨理由：  1. 動的性：自動収集されたファクトはPlaybookをより動的かつスマートにします。 2.  ハードコーディングの回避：ハードコーディングされた値への依存を減らし、移植性を高めます。 3.  Host固有：ファクトはHost固有であり、適応性が高いです。 |
| 12   | play  vars                                                   | 12                | Playbook内のplayで定義された変数。該当play内のすべてのタスクに適用されます。 | Playbookファイル内で、playのvarsセクションに定義             | yaml     # playbook.yml     - hosts: webservers      vars:      app_port: 8080      tasks:      - name: Start the application      service:      name: myapp      state: started | 慎重に使用                                                   | 1.  変数の競合：play内で定義された変数が他の変数を意図せず上書きする可能性があります。 2. 限定された適用範囲：変数はplay内に限定され、重複が発生する可能性があります。 3. 調整の必要性：競合を避けるため、チーム間でのコミュニケーションが必要です。 |
| 13   | play  vars_prompt                                            | 13                | Playbook実行時にユーザーに入力を促す変数。                   | Playbookファイル内で、vars_promptセクションに定義            | yaml     # playbook.yml     - hosts: all      vars_prompt:      - name:  "admin_password"      prompt: "Enter the admin  password"      private: yes      tasks:      - name: Set admin password      user:      name: admin      password: "{{ admin_password  }}" | 非推奨                                                       | 1.  自動化の妨げ：手動入力が必要であり、自動化プロセスを阻害します。 2. 拡張性：大量のHostでの実行時には実用的ではありません。 3.  一貫性の欠如：ユーザーによって異なる値が入力される可能性があります。 |
| 14   | play  vars_files                                             | 14                | 外部ファイルから読み込まれる変数。変数をPlaybookコードから分離できます。 | Playbook内で、vars_filesセクションに変数ファイルのパスを指定 | yaml     # playbook.yml     - hosts: all      vars_files:      - vars/common.yml      tasks:      - name: Use common variables      debug:      msg: "{{ common_var  }}"      yaml     # vars/common.yml     common_var: "This is a common variable" | 推奨                                                         | 推奨理由： 1. モジュール化：変数をコードから分離し、構造を改善します。 2. 再利用性：変数ファイルは複数のPlaybookで再利用できます。 3. 保守性：変数の管理と更新が容易です。 |
| 15   | role  vars（Roleディレクトリ構造で定義）                     | 15                | Roleのvarsディレクトリ内で定義された変数。defaultsより優先順位が高く、上書きされたくない変数に使用します。 | roles/role_name/vars/main.yml                                | yaml     # roles/role_name/vars/main.yml     role_var: "value" | 非推奨                                                       | 1.  上書きの困難さ：vars/内の変数は優先順位が高く、上書きが難しく、柔軟性が制限されます。 2. 競合の可能性：他のRoleやplayで同じ変数名が定義されている場合、競合が発生する可能性があります。 3. 再利用性の低下：固定された変数により、Roleの汎用性が制限されます。 |
| 16   | block  vars（ブロック内のタスクにのみ適用）                  | 16                | Playbookのblock内で定義された変数。該当block内のタスクにのみ適用されます。 | Playbookのblock内で定義                                      | yaml     # playbook.yml     - hosts: all      tasks:      - block:      - name: Do something      debug:      msg: "{{ block_var  }}"      vars:      block_var: "value" | 慎重に使用                                                   | 1.  限定された適用範囲：変数はblock内に限定され、コードの理解難易度が増す可能性があります。 2. 混乱の可能性：過度の使用は変数が意図せず上書きされる可能性があります。 |
| 17   | task  vars（タスクにのみ適用）                               | 17                | タスク内で定義された変数。該当タスクにのみ適用されます。     | タスク内で直接定義                                           | yaml     # playbook.yml     - hosts: all      tasks:      - name: Install package      apt:      name: "{{ pkg_name  }}"      vars:      pkg_name: "nginx" | 非推奨                                                       | 1.  限定された適用範囲：変数はタスク内に限定され、コードの再利用性が低下します。 2. 可読性：タスク内で変数を定義すると、タスク定義が冗長になります。 3. 保守の複雑さ：複数のタスク間で変数を共有するのが困難です。 |
| 18   | include_vars                                                 | 18                | include_varsモジュールを使用して実行時に変数を読み込みます。 | タスク内でinclude_varsモジュールを使用して指定               | yaml     # playbook.yml     - hosts: all      tasks:      - name: Include variables      include_vars:      file: vars/{{ inventory_hostname  }}.yml           - name: Use included variable      debug:      msg: "{{ included_var  }}"      yaml     # vars/web1.example.com.yml     included_var: "Value for web1" | 慎重に使用                                                   | 1.  変数の競合：実行時に変数を読み込むと、管理が不十分な場合に競合が発生する可能性があります。 2.  複雑さ：動的に変数を含めると、Playbookの理解とデバッグが困難になります。 3.  予測不可能性：Host名などの動的要素に依存すると、予期せぬ動作を引き起こす可能性があります。 |
| 19   | set_facts  / registered vars                                 | 19                | set_factを使用して定義された、またはタスクの出力から登録された変数。 | タスク内でset_factまたはregisterキーワードを使用             | yaml     # playbook.yml     - hosts: all      tasks:      - name: Set a fact      set_fact:      dynamic_var: "value"           - name: Run a command      command: "echo  Hello"      register: cmd_output           - name: Display command output      debug:      msg: "{{ cmd_output.stdout  }}" | 慎重に使用                                                   | 1.  限定された適用範囲：登録された変数はHost固有であり、必要な場所で使用できない可能性があります。 2.  変数の競合：set_factは管理が不十分な場合、既存の変数を上書きする可能性があります。 3.  デバッグの複雑さ：set_factの過度の使用はデバッグ難易度を増加させます。 |
| 20   | role（およびinclude_role）のパラメータ                       | 20                | Roleを含めるまたはインポートする際に、パラメータを通じてRoleに変数を渡します。これにより、Roleをパラメータ化できます。 | Playbook内でRoleを含める際に指定                             | yaml     # playbook.yml     - hosts: all      roles:      - role: myrole      vars:      role_var: "value" | 推奨                                                         | 推奨理由： 1. 柔軟性：パラメータを使用してRoleをより設定可能かつ再利用可能にします。 2. 明示性：変数が明示的に渡され、意図しない変数の競合を減少させます。 3. 保守性：コードの明瞭性と保守性を向上させます。 |
| 21   | includeのパラメータ                                          | 21                | タスクまたはPlaybookを含めるまたはインポートする際に渡される変数。 | Playbook内でタスクまたはPlaybookを含める際に指定             | yaml     # playbook.yml     - hosts: all      tasks:      - name: Include tasks with  variables      include_tasks: tasks/mytasks.yml      vars:      task_var: "value"      yaml     # tasks/mytasks.yml     - name: Use included variable      debug:      msg: "{{ task_var  }}" | 推奨                                                         | 推奨理由： 1. モジュール化：コードのモジュール化と再利用性を強化します。 2. 明示的な伝達：変数競合のリスクを減少させます。 3. 局所化：変数が含まれる内容内に限定され、グローバル変数の汚染を防ぎます。 |
| 22   | extra  vars（例：-e "user=my_user"）（常に優先順位が最も高い） | 22                | Ansibleコマンド実行時に、-eまたは--extra-varsで渡される変数。 | コマンドラインで-eオプションを使用して指定                   | shell     ansible-playbook playbook.yml -e "var1=value1 var2=value2"          ansible-playbook playbook.yml -e '{"var1": "value1",  "var2": "value2"}' | 推奨                                                         | 推奨理由： 1. 明示的な上書き：Ansible実行時に変数値を明示的に指定し、変数を上書きできます。 2. 最高優先順位：他の変数に上書きされることなく、期待した変数値を使用できます。 3. 柔軟性：一時的な調整や機密データの伝達に適しています。 |